/*
Module: logs-from-api
Description: Performs Kubernetes service discovery for pods, applies relabelings, the discovered target logs are
             then retrieved from the kubernetes api
*/
argument "forward_to" {
	// comment = "Must be a list(LogsReceiver) where collected logs should be forwarded to"
	optional = false
}

discovery.kubernetes "pods" {
	role = "pod"
}

module.file "relabelings_log" {
	filename = coalesce(env("AGENT_CONFIG_FOLDER"), "/etc/agent-modules") + "/kubernetes/logs/relabelings.river"

	arguments {
		targets = discovery.kubernetes.pods.targets
		tenant  = argument.tenant.value
	}
}

loki.source.kubernetes "pods" {
	targets    = module.file.relabelings_log.exports.relabelings.output
	forward_to = argument.forward_to.value
}
