/*
The following example shows using the default all logs processing module, for
a single tenant and specifying the destination url/credentials via environment
variables.
*/
logging {
  level  = coalesce(env("AGENT_LOG_LEVEL"), "info")
  format = "logfmt"
}

module.file "lgtmp" {
	filename = env("AGENT_CONFIG_FOLDER") + "/lgtmp.river"

	arguments {
    cluster           = env("CLUSTER")
    metrics_endpoint  = env("METRICS_ENDPOINT")
    logs_endpoint     = env("LOGS_ENDPOINT")
    profiles_endpoint = env("PROFILES_ENDPOINT")
	}
}

/********************************************
 * Metrics
 ********************************************/
module.file "metrics_primary" {
	filename = env("AGENT_CONFIG_FOLDER") + "/metrics.river"

  arguments {
    forward_to = [module.file.lgtmp.exports.metrics_receiver]
    clustering = true
  }
}

/********************************************
 * Logs
 ********************************************/
module.git "event_logs" {
  repository = "https://github.com/grafana/agent-modules.git"
  revision   = "main"
  path       = "modules/kubernetes/logs/events.river"

  arguments {
    forward_to = [module.file.lgtmp.exports.logs_receiver]
    git_pull_freq = "0s"
  }
}

/********************************************
 * Profiles
 ********************************************/
module.file "profiles_primary" {
	filename = env("AGENT_CONFIG_FOLDER") + "/profiles.river"

  arguments {
    forward_to = [module.file.lgtmp.exports.profiles_receiver]
    clustering = true
  }
}
