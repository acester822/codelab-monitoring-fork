apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: logging-system

helmCharts:
- name: grafana-agent
  version: 0.27.2
  repo: https://grafana.github.io/helm-charts
  releaseName: grafana-agent
  namespace: logging-system
  includeCRDs: false
  valuesFile: values-k3d-k3s.yaml

configMapGenerator:
- name: agent-logs-config
  files:
  - configs/logs.river

- name: agent-modules
  files:
  - configs/modules/grafana-cloud.river
  - configs/modules/lgtmp.river
  - configs/modules/logs-all.river

secretGenerator:
- name: agent-logs-env
  literals:
  - AGENT_LOG_LEVEL=info
  - AGENT_CONFIG_FOLDER=/etc/agent-modules
  - CLUSTER=k3d-k3s-codelab
  - LOGS_ENDPOINT=http://loki.logging-system:3100
