logging {
  level  = coalesce(env("AGENT_LOG_LEVEL"), "info")
  format = "logfmt"
}

module.file "lgtmp" {
	filename = env("AGENT_CONFIG_FOLDER") + "/lgtmp.river"

	arguments {
    cluster          = coalesce(env("CLUSTER"), "k3d-k3s-codelab")
    metrics_endpoint = coalesce(env("METRICS_ENDPOINT"), "http://nginx.monitoring-system:8080")
	}
}

module.file "metrics_primary" {
	filename = env("AGENT_CONFIG_FOLDER") + "/metrics-all.river"

  arguments {
    forward_to = [module.file.lgtmp.exports.metrics_receiver]
    clustering = true
  }
}