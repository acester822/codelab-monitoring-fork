// https://github.com/grafana/agent-configurator

logging {
	level  = coalesce(env("AGENT_LOG_LEVEL"), "info")
	format = "logfmt"
}

/********************************************
 * Grafana LGTMP Stack Receiver Provider
 ********************************************/
import.file "provider" {
	filename = coalesce(env("AGENT_CONFIG_FOLDER"), "/etc/agent-config") + "/modules/provider.river"
}

provider.lgtmp_stack "docker_compose" {
	logs_endpoint    = "http://gateway:3100"
	metrics_endpoint = "http://gateway:8080"
	traces_endpoint  = "gateway:4317"
}

/********************************************
 * Traces
 ********************************************/
module.file "traces_primary" {
	filename = coalesce(env("AGENT_CONFIG_FOLDER"), "/etc/agent-config") + "/modules/docker/traces/all.river"

	arguments {
		metrics_forward_to = [provider.lgtmp_stack.docker_compose.metrics_receiver]
		logs_forward_to    = [provider.lgtmp_stack.docker_compose.logs_receiver]
		traces_forward_to  = [provider.lgtmp_stack.docker_compose.traces_receiver]
	}
}

/********************************************
 * Metrics
 ********************************************/
module.file "metrics_primary" {
	filename = coalesce(env("AGENT_CONFIG_FOLDER"), "/etc/agent-config") + "/modules/docker/metrics/all.river"

	arguments {
		forward_to = [provider.lgtmp_stack.docker_compose.metrics_receiver]
	}
}
